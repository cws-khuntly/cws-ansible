#=====  ANSIBLE   =============================================================
#          NAME:  build-zimbra/tasks/run-installation.yml
#   DESCRIPTION:  Performs base Zimbra installation for maildrop/LDAP
#==============================================================================
---
##
## Create user group/account
##
- name: (INSTALL) Create Zimbra user group
  group:
    gid=454
    name=zimbra
    state=present
    system=yes

- name: (INSTALL) Create Zimbra user account
  user:
    group=zimbra
    groups=adm,tty,postfix
    home=/opt/zimbra
    name=zimbra
    shell=/bin/bash
    state=present
    system=yes
    uid=454

##
## Run installation steps
##
- name: (INSTALL) Install netcat
  yum:
    name=nc
    state=present

- name: (INSTALL) Install zimbra core
  yum:
    name="zimbra-core-{{ pkg_version }}.{{ hostvars[inventory_hostname]['ansible_architecture'] }}"
    state=present

- name: (INSTALL) Install zimbra meta baseline
  yum:
    name="meta-zimbra-baseline-1.0.3-1.noarch"
    state=present

- name: (INSTALL) Include LDAP installation tasks
  include: ldap/install.yml
  when: is_ldap

- name: (INSTALL) Include maildrop installation tasks
  include: maildrop/install.yml
  when: is_maildrop

- name: (INSTALL) Include POP installation tasks
  include: pop/install.yml
  when: is_pop

- name: Notify puppet
  command: /usr/bin/puppet agent -t
  ignore_errors: yes

##
## INSTALLATION COMPLETE
##
