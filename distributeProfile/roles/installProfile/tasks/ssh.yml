#======  ANSIBLE  ============================================================
#          NAME:  tasks/ssh.yml
#   DESCRIPTION:  Add authorized_keys to target hosts
#==============================================================================
---
##
## Send public keys
##
- name: Set up authorized_keys
  authorized_key:
    key="{{ item }}"
    state=present
    user=khuntly
    exclusive=yes
  with_file:
    - "{{ ssh_keyfile }}"

- name: update ssh config
  template:
    src=ssh/config.j2
    dest="{{ remote_home }}/.ssh/config"
    owner="{{ remote_user }}"
    group="{{ remote_group }}"
    mode=0644

- name: Remove existing known_hosts file
  file:
    path: /home/khuntly/.ssh/known_hosts
    state: absent
